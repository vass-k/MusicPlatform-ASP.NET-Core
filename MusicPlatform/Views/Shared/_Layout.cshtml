@using Microsoft.AspNetCore.Identity
@using MusicPlatform.Data.Models
@using static MusicPlatform.GCommon.ApplicationConstants

@* Inject the services needed for checking login status and user details *@
@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager

@{
    // This C# logic gets the name of the current controller to help with active link highlighting.
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString() ?? "Home";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>MusicPlatform - Discover New Music</title>

    <!-- Template CSS Files -->
    <link rel="stylesheet" type="text/css" href="~/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="~/css/font-awesome.css">
    <link rel="stylesheet" href="~/css/templatemo.css">
    <link rel="stylesheet" href="~/css/owl-carousel.css">
    <link rel="icon" type="image/x-icon" href="~/favicon.ico">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" integrity="sha512-6S2HWzVFxruDlZxI3sXOZZ4/eJ8AcxkQH1+JjSe/ONCEqR9L4Ysq5JdT5ipqtzU7WHalNwzwBv+iE51gNHJNqQ==" crossorigin="anonymous" referrerpolicy="no-referrer">
</head>
<body class="@(currentController == "Home" ? "is-homepage" : "is-subpage")">
    <!-- ***** Preloader Start ***** -->
    <div id="preloader">
        <div class="jumper">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <!-- ***** Preloader End ***** -->
    <!-- ***** Header Area Start - UPDATED AND FUNCTIONAL ***** -->
    <header class="header-area header-sticky">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <!-- Logo -->
                        <a href="/" class="logo">
                            <img src="~/images/logo.png" alt="MusicPlatform Logo" />
                        </a>

                        <!-- Navigation -->
                        <ul class="nav">
                            <li><a href="/" class="@(currentController == "Home" ? "active" : "")">Home</a></li>
                            <li><a asp-controller="Track" asp-action="Index" class="@(currentController == "Track" ? "active" : "")">Tracks</a></li>
                            <li><a asp-controller="Genre" asp-action="Index" class="@(currentController == "Genre" ? "active" : "")">Genres</a></li>

                            <!-- This is the new dynamic dropdown menu -->
                            <li class="submenu">
                                <a href="javascript:;">Profile</a>
                                <ul>
                                    @if (SignInManager.IsSignedIn(User))
                                    {
                                        <!-- Show these links if the user IS logged in -->
                                        <li><a asp-controller="Profile" asp-action="Index" asp-route-username="@UserManager.GetUserName(User)">My Profile</a></li>
                                        @if (User.IsInRole(AdminRoleName))
                                        {
                                            <li><a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">Dashboard</a></li>
                                        }
                                        <li><a asp-controller="Track" asp-action="Add">Upload</a></li>
                                        <li><a asp-area="Identity" asp-page="/Account/Manage/Index">Settings</a></li>
                                        <li>
                                            <form class="form-inline" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })">
                                                <button type="submit" class="logout-button">Logout</button>
                                            </form>
                                        </li>
                                    }
                                    else
                                    {
                                        <!-- Show these links if the user IS NOT logged in -->
                                        <li><a asp-area="Identity" asp-page="/Account/Login">Login</a></li>
                                        <li><a asp-area="Identity" asp-page="/Account/Register">Register</a></li>
                                    }
                                </ul>
                            </li>
                        </ul>
                        <a class='menu-trigger'>
                            <span>Menu</span>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        @RenderBody()
    </main>

    <!-- Footer remains the same -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-top">
                <div class="footer-logo">
                    <a asp-controller="Home" asp-action="Index">MusicPlatform</a>
                </div>
                <nav class="footer-nav">
                    <ul>
                        <li><a asp-controller="Home" asp-action="About">About</a></li>
                        <li><a asp-controller="Home" asp-action="Privacy">Privacy Policy</a></li>
                        <li><a asp-controller="Home" asp-action="Licensing">Licensing</a></li>
                        <li><a asp-controller="Home" asp-action="Contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
            <hr />
            <div class="footer-bottom">
                <span>© @DateTime.Now.Year MusicPlatform. All Rights Reserved.</span>
            </div>
        </div>
    </footer>

    <!-- JS Files remain the same -->
    <script src="~/js/jquery-2.1.0.min.js"></script>
    <script src="~/js/popper.js"></script>
    <script src="~/js/bootstrap.min.js"></script>
    <script src="~/js/owl-carousel.js"></script>
    <script src="~/js/scrollreveal.min.js"></script>
    <script src="~/js/custom.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js" integrity="sha512-lbwH47l/tPXJYG9AcFNoJaTMhGvYWhVM9YI43CT+uteTRRaiLCui8snIgyAN8XWgNjNhCqlAUdzZptso6OCoFQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        toastr.options = {
            "progressBar": true,
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "show",
            "hideMethod": "hide"
        };
    </script>

    <partial name="_NotificationsPartial" />

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>